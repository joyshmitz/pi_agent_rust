{
  "version": "1.0",
  "tool": "edit",
  "description": "Conformance tests for the edit tool (pi-mono parity)",
  "cases": [
    {
      "name": "edit_simple_replace",
      "description": "Simple text replacement",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "Hello, World!"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "World",
        "newText": "Rust"
      },
      "expected": {
        "content_exact": "Successfully replaced text in test.txt.",
        "details_exact": {
          "diff": "-1 Hello, World!\n+1 Hello, Rust!",
          "firstChangedLine": 1
        }
      }
    },
    {
      "name": "edit_multiline",
      "description": "Replace multiline content",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "line1\nline2\nline3"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "line2",
        "newText": "replaced"
      },
      "expected": {
        "content_exact": "Successfully replaced text in test.txt.",
        "details_exact": {
          "diff": " 1 line1\n-2 line2\n+2 replaced\n 3 line3",
          "firstChangedLine": 2
        }
      }
    },
    {
      "name": "edit_text_not_found",
      "description": "Editing non-existent text should error",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "Hello, World!"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "NotFound",
        "newText": "New"
      },
      "expect_error": true,
      "error_contains": "Could not find the exact text in test.txt",
      "expected": {}
    },
    {
      "name": "edit_nonexistent_file",
      "description": "Editing non-existent file should error",
      "input": {
        "path": "/nonexistent/file.txt",
        "oldText": "old",
        "newText": "new"
      },
      "expect_error": true,
      "error_contains": "File not found",
      "expected": {}
    },
    {
      "name": "edit_multiple_occurrences",
      "description": "If oldText occurs more than once, edit should error",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "Hello, Hello, Hello!"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "Hello",
        "newText": "Hi"
      },
      "expect_error": true,
      "error_contains": "Found 3 occurrences",
      "expected": {}
    },
    {
      "name": "edit_with_special_chars",
      "description": "Edit text with special characters",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "function() { return x; }"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "function() { return x; }",
        "newText": "const fn = () => x;"
      },
      "expected": {
        "content_exact": "Successfully replaced text in test.txt.",
        "details_exact": {
          "diff": "-1 function() { return x; }\n+1 const fn = () => x;",
          "firstChangedLine": 1
        }
      }
    },
    {
      "name": "edit_unicode_content",
      "description": "Edit file with Unicode content",
      "setup": [
        {"type": "create_file", "path": "test.txt", "content": "Hello 世界"}
      ],
      "input": {
        "path": "test.txt",
        "oldText": "世界",
        "newText": "World"
      },
      "expected": {
        "content_exact": "Successfully replaced text in test.txt.",
        "details_exact": {
          "diff": "-1 Hello 世界\n+1 Hello World",
          "firstChangedLine": 1
        }
      }
    }
  ]
}
