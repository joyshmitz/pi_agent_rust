{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"AAAA;;;;;;;GAOG;AAGH,OAAO,EAAE,aAAa,EAAE,MAAM,+BAA+B,CAAC;AAC9D,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,UAAU,EAAmB,UAAU,EAAE,IAAI,EAAE,MAAM,sBAAsB,CAAC;AACrG,OAAO,EAAE,YAAY,EAAE,MAAM,oBAAoB,CAAC;AAElD,OAAO,EAAE,eAAe,EAAE,MAAM,aAAa,CAAC;AAE9C,MAAM,UAAU,GAAG,UAAU,CAAC;AAC9B,MAAM,kBAAkB,GAAG,IAAI,CAAC;AAChC,MAAM,gBAAgB,GAAG,IAAI,CAAC;AAE9B,MAAM,CAAC,OAAO,WAAW,EAAgB;IACxC,MAAM,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;IAElC,wEAAwE;IACxE,MAAM,WAAW,GAAG,IAAI,GAAG,EAAuB,CAAC;IAEnD,cAAc;IACd,IAAI,UAA8B,CAAC;IAEnC,kBAAkB;IAClB,IAAI,WAAqC,CAAC;IAC1C,IAAI,cAAyD,CAAC;IAC9D,IAAI,YAAwD,CAAC;IAC7D,IAAI,UAAwC,CAAC;IAE7C;;OAEG;IACH,SAAS,YAAY;QACpB,IAAI,CAAC,UAAU,EAAE,KAAK;YAAE,OAAO;QAE/B,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC;QAE9C,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACvB,UAAU,CAAC,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;YAC/C,QAAQ,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,UAAU,CAAC,EAAE,CAAC,SAAS,CACtB,UAAU,EACV,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;YACf,OAAO;gBACN,MAAM,EAAE,CAAC,KAAa,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC;gBAC9D,UAAU,EAAE,GAAG,EAAE,GAAE,CAAC;aACpB,CAAC;QACH,CAAC,EACD,EAAE,SAAS,EAAE,aAAa,EAAE,CAC5B,CAAC;QAEF,SAAS,EAAE,CAAC;IACb,CAAC;IAED;;OAEG;IACH,SAAS,SAAS;QACjB,IAAI,YAAY;YAAE,OAAO;QACzB,YAAY,GAAG,WAAW,CAAC,GAAG,EAAE;YAC/B,IAAI,WAAW,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC;gBAC1B,YAAY,EAAE,CAAC;YAChB,CAAC;iBAAM,CAAC;gBACP,QAAQ,EAAE,CAAC;YACZ,CAAC;QACF,CAAC,EAAE,gBAAgB,CAAC,CAAC;IACtB,CAAC;IAED;;OAEG;IACH,SAAS,QAAQ;QAChB,IAAI,YAAY,EAAE,CAAC;YAClB,aAAa,CAAC,YAAY,CAAC,CAAC;YAC5B,YAAY,GAAG,SAAS,CAAC;QAC1B,CAAC;IACF,CAAC;IAED;;OAEG;IACH,SAAS,WAAW,CAAC,KAAY;QAChC,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;QAEtB,QAAQ,KAAK,CAAC,IAAI,EAAE,CAAC;YACpB,KAAK,WAAW,CAAC;YACjB,KAAK,aAAa,CAAC;YACnB,KAAK,aAAa,CAAC;YACnB,KAAK,aAAa,CAAC;YACnB,KAAK,eAAe;gBACnB,IAAI,GAAG,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;oBAC9B,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;gBAC9B,CAAC;qBAAM,CAAC;oBACP,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAC5B,CAAC;gBACD,MAAM;YAEP,KAAK,aAAa,CAAC;YACnB,KAAK,aAAa;gBACjB,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAC3B,MAAM;YAEP,KAAK,aAAa,CAAC;YACnB,KAAK,aAAa;gBACjB,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAC3B,MAAM;QACR,CAAC;QAED,YAAY,EAAE,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,KAAK,UAAU,mBAAmB;QACjC,8BAA8B;QAC9B,IAAI,cAAc,EAAE,CAAC;YACpB,YAAY,CAAC,cAAc,CAAC,CAAC;YAC7B,cAAc,GAAG,SAAS,CAAC;QAC5B,CAAC;QAED,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC,OAAO,EAAE,CAAC;QAClC,IAAI,CAAC,EAAE,EAAE,CAAC;YACT,yCAAyC;YACzC,iBAAiB,EAAE,CAAC;YACpB,OAAO;QACR,CAAC;QAED,IAAI,CAAC;YACJ,6BAA6B;YAC7B,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC3C,WAAW,CAAC,KAAK,EAAE,CAAC;YACpB,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE,CAAC;gBACxB,IAAI,GAAG,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;oBAC9B,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;gBAC9B,CAAC;YACF,CAAC;YACD,YAAY,EAAE,CAAC;QAChB,CAAC;QAAC,MAAM,CAAC;YACR,qCAAqC;YACrC,iBAAiB,EAAE,CAAC;YACpB,OAAO;QACR,CAAC;QAED,sBAAsB;QACtB,WAAW,GAAG,MAAM,CAAC,SAAS,CAC7B,UAAU,EACV,CAAC,KAAK,EAAE,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,EAC7B,CAAC,IAAI,EAAE,EAAE;YACR,8CAA8C;YAC9C,WAAW,GAAG,SAAS,CAAC;YACxB,WAAW,CAAC,KAAK,EAAE,CAAC;YACpB,YAAY,EAAE,CAAC;YACf,iBAAiB,EAAE,CAAC;QACrB,CAAC,CACD,CAAC;IACH,CAAC;IAED;;OAEG;IACH,SAAS,iBAAiB;QACzB,IAAI,cAAc;YAAE,OAAO;QAC3B,cAAc,GAAG,UAAU,CAAC,GAAG,EAAE;YAChC,cAAc,GAAG,SAAS,CAAC;YAC3B,mBAAmB,EAAE,CAAC;QACvB,CAAC,EAAE,kBAAkB,CAAC,CAAC;IACxB,CAAC;IAED;;OAEG;IACH,SAAS,OAAO;QACf,IAAI,WAAW,EAAE,CAAC;YACjB,WAAW,EAAE,CAAC;YACd,WAAW,GAAG,SAAS,CAAC;QACzB,CAAC;QACD,IAAI,cAAc,EAAE,CAAC;YACpB,YAAY,CAAC,cAAc,CAAC,CAAC;YAC7B,cAAc,GAAG,SAAS,CAAC;QAC5B,CAAC;QACD,QAAQ,EAAE,CAAC;QACX,MAAM,CAAC,UAAU,EAAE,CAAC;QACpB,WAAW,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC;IAED,0DAA0D;IAE1D,EAAE,CAAC,EAAE,CAAC,eAAe,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE;QAC5C,UAAU,GAAG,GAAG,CAAC;QACjB,UAAU,GAAG,GAAG,CAAC,GAAG,CAAC;QACrB,MAAM,mBAAmB,EAAE,CAAC;IAC7B,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,EAAE,CAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;QACpC,OAAO,EAAE,CAAC;QACV,IAAI,UAAU,EAAE,KAAK,EAAE,CAAC;YACvB,UAAU,CAAC,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAChD,CAAC;QACD,UAAU,GAAG,SAAS,CAAC;IACxB,CAAC,CAAC,CAAC;IAEH,wEAAwE;IAExE,KAAK,UAAU,SAAS;QACvB,4BAA4B;QAC5B,IAAI,MAAM,CAAC,SAAS,EAAE,CAAC;YACtB,IAAI,CAAC;gBACJ,OAAO,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACtC,CAAC;YAAC,MAAM,CAAC;gBACR,sBAAsB;YACvB,CAAC;QACF,CAAC;QAED,eAAe;QACf,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;QAC9C,IAAI,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;YACvB,OAAO,EAAE,CAAC;QACX,CAAC;QACD,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC;IAED,SAAS,YAAY,CAAC,MAAc;QACnC,MAAM,IAAI,GAAkB,EAAE,CAAC;QAC/B,MAAM,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAEpE,IAAI,CAAC,GAAG,CAAC,CAAC;QACV,OAAO,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC;YACzB,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;YACtB,8DAA8D;YAC9D,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAC;YAC1E,IAAI,KAAK,EAAE,CAAC;gBACX,MAAM,WAAW,GAChB,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;gBAEhG,IAAI,WAAW;oBAAE,CAAC,EAAE,CAAC;gBAErB,IAAI,CAAC,IAAI,CAAC;oBACT,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC;oBACZ,GAAG,EAAE,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC;oBACvC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;oBAChB,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC;oBAC5B,OAAO,EAAE,EAAE;oBACX,WAAW;oBACX,UAAU,EAAE,EAAE;oBACd,UAAU,EAAE,EAAE;oBACd,WAAW,EAAE,EAAE;oBACf,WAAW,EAAE,EAAE;oBACf,SAAS,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS;oBAC/D,SAAS,EAAE,CAAC;oBACZ,aAAa,EAAE,CAAC;oBAChB,aAAa,EAAE,CAAC;oBAChB,YAAY,EAAE,CAAC;oBACf,eAAe,EAAE,CAAC;oBAClB,uBAAuB,EAAE,CAAC;oBAC1B,eAAe,EAAE,CAAC;oBAClB,eAAe,EAAE,CAAC;iBAClB,CAAC,CAAC;YACJ,CAAC;YACD,CAAC,EAAE,CAAC;QACL,CAAC;QAED,OAAO,IAAI,CAAC;IACb,CAAC;IAED,KAAK,UAAU,gBAAgB,CAAC,MAAc,EAAE,KAAa;QAC5D,4BAA4B;QAC5B,IAAI,MAAM,CAAC,SAAS,EAAE,CAAC;YACtB,IAAI,CAAC;gBACJ,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;gBACjE,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;oBAClB,MAAM,IAAI,GACT,MAAM,KAAK,MAAM;wBAChB,CAAC,CAAC,SAAS;wBACX,CAAC,CAAC,MAAM,KAAK,OAAO;4BACnB,CAAC,CAAC,SAAS;4BACX,CAAC,CAAC,MAAM,KAAK,SAAS;gCACrB,CAAC,CAAC,WAAW;gCACb,CAAC,CAAC,MAAM,KAAK,QAAQ;oCACpB,CAAC,CAAC,SAAS;oCACX,CAAC,CAAC,MAAM,CAAC;oBACd,OAAO,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI,KAAK,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;gBACvD,CAAC;gBACD,OAAO,EAAE,OAAO,EAAE,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;YAC5D,CAAC;YAAC,MAAM,CAAC;gBACR,sBAAsB;YACvB,CAAC;QACF,CAAC;QAED,eAAe;QACf,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;QACrD,IAAI,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;YACvB,MAAM,IAAI,GACT,MAAM,KAAK,MAAM;gBAChB,CAAC,CAAC,SAAS;gBACX,CAAC,CAAC,MAAM,KAAK,OAAO;oBACnB,CAAC,CAAC,SAAS;oBACX,CAAC,CAAC,MAAM,KAAK,SAAS;wBACrB,CAAC,CAAC,WAAW;wBACb,CAAC,CAAC,MAAM,KAAK,QAAQ;4BACpB,CAAC,CAAC,SAAS;4BACX,CAAC,CAAC,MAAM,CAAC;YACd,OAAO,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI,KAAK,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QACvD,CAAC;QACD,OAAO,EAAE,OAAO,EAAE,UAAU,MAAM,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;IAC/D,CAAC;IAED,MAAM,WAAW,GAAG,KAAK,EAAE,GAAqB,EAAE,EAAE;QACnD,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;YAChB,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;YAC1C,OAAO;QACR,CAAC;QAED,MAAM,IAAI,GAAG,MAAM,SAAS,EAAE,CAAC;QAE/B,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACvB,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAC;YAC3C,OAAO;QACR,CAAC;QAED,MAAM,GAAG,CAAC,EAAE,CAAC,MAAM,CAAO,CAAC,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;YACnD,MAAM,SAAS,GAAG,IAAI,SAAS,EAAE,CAAC;YAElC,aAAa;YACb,SAAS,CAAC,QAAQ,CAAC,IAAI,aAAa,CAAC,CAAC,CAAS,EAAE,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAE5E,QAAQ;YACR,SAAS,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAEhF,qBAAqB;YACrB,MAAM,KAAK,GAAiB,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC5C,MAAM,WAAW,GAAG,GAAG,CAAC,MAAM,KAAK,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC;gBACnE,MAAM,UAAU,GAAG,GAAG,CAAC,MAAM,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;gBACxD,MAAM,QAAQ,GACb,GAAG,CAAC,MAAM,KAAK,SAAS,IAAI,GAAG,CAAC,SAAS,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;gBACjG,MAAM,MAAM,GAAG,KAAK,CAAC,EAAE,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;gBACjD,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACrC,MAAM,KAAK,GAAG,GAAG,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,GAAG,CAAC,EAAE,CAAC,IAAI,MAAM,GAAG,QAAQ,EAAE,CAAC;gBAC1E,MAAM,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBACrF,OAAO;oBACN,KAAK,EAAE,GAAG,CAAC,EAAE;oBACb,KAAK;oBACL,WAAW;iBACX,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;YAC9C,IAAI,YAAY,GAAG,CAAC,CAAC;YAErB,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,KAAK,EAAE,WAAW,EAAE;gBACrD,cAAc,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;gBAC5C,YAAY,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACtB,WAAW,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACrB,UAAU,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;gBACrC,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC;aACtC,CAAC,CAAC;YAEH,UAAU,CAAC,QAAQ,GAAG,KAAK,EAAE,IAAI,EAAE,EAAE;gBACpC,IAAI,EAAE,CAAC;gBACP,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,KAAK,CAAC,CAAC;gBAClD,IAAI,GAAG,EAAE,CAAC;oBACT,MAAM,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;gBAChC,CAAC;YACF,CAAC,CAAC;YACF,UAAU,CAAC,QAAQ,GAAG,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC;YACnC,UAAU,CAAC,iBAAiB,GAAG,CAAC,IAAI,EAAE,EAAE;gBACvC,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACpC,CAAC,CAAC;YACF,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YAE/B,YAAY;YACZ,SAAS,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,oDAAoD,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAE1G,gBAAgB;YAChB,SAAS,CAAC,QAAQ,CAAC,IAAI,aAAa,CAAC,CAAC,CAAS,EAAE,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAE5E,OAAO;gBACN,MAAM,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;gBAClC,UAAU,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE;gBACxC,WAAW,EAAE,CAAC,IAAI,EAAE,EAAE;oBACrB,IAAI,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;wBAChC,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,YAAY,GAAG,WAAW,CAAC,CAAC;wBACvD,UAAU,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;oBAC3C,CAAC;yBAAM,IAAI,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;wBACxC,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,YAAY,GAAG,WAAW,CAAC,CAAC;wBACtE,UAAU,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;oBAC3C,CAAC;yBAAM,CAAC;wBACP,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;oBAC9B,CAAC;oBACD,GAAG,CAAC,aAAa,EAAE,CAAC;gBACrB,CAAC;aACD,CAAC;QACH,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,MAAM,cAAc,GAAG,KAAK,EAAE,GAAqB,EAAE,GAAgB,EAAE,EAAE;QACxE,MAAM,OAAO,GAAa,EAAE,CAAC;QAE7B,IAAI,GAAG,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;YAC9B,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC;QACzC,CAAC;aAAM,CAAC;YACP,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;QACpD,CAAC;QAED,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACrC,MAAM,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,EAAE,EAAE,OAAO,CAAC,CAAC;QACpE,IAAI,CAAC,MAAM;YAAE,OAAO;QAEpB,QAAQ,MAAM,EAAE,CAAC;YAChB,KAAK,MAAM,CAAC,CAAC,CAAC;gBACb,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;gBACzF,IAAI,MAAM,CAAC,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,CAAC;oBAC/C,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,YAAY,GAAG,CAAC,EAAE,MAAM,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC;gBACvE,CAAC;qBAAM,CAAC;oBACP,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,eAAe,GAAG,CAAC,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC;gBAChD,CAAC;gBACD,MAAM;YACP,CAAC;YACD,KAAK,MAAM,CAAC;YACZ,KAAK,OAAO,CAAC;YACb,KAAK,SAAS,CAAC;YACf,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACf,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;gBACtD,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;gBACjE,MAAM;YACP,CAAC;QACF,CAAC;IACF,CAAC,CAAC;IAEF,wBAAwB;IACxB,EAAE,CAAC,eAAe,CAAC,KAAK,EAAE;QACzB,WAAW,EAAE,qCAAqC;QAClD,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC;KAC/C,CAAC,CAAC;AACJ,CAAC","sourcesContent":["/**\n * Gob Extension\n *\n * Manages gob background jobs from within pi.\n * Connects to the gob daemon via Unix socket for real-time job monitoring.\n * Shows a widget below the editor with running jobs.\n * Use /gob to view and interact with running and stopped jobs.\n */\n\nimport type { ExtensionAPI, ExtensionContext } from \"@mariozechner/pi-coding-agent\";\nimport { DynamicBorder } from \"@mariozechner/pi-coding-agent\";\nimport { Container, Key, matchesKey, type SelectItem, SelectList, Text } from \"@mariozechner/pi-tui\";\nimport { DaemonClient } from \"./daemon-client.js\";\nimport type { Event, JobResponse } from \"./types.js\";\nimport { renderJobWidget } from \"./widget.js\";\n\nconst WIDGET_KEY = \"gob-jobs\";\nconst RECONNECT_DELAY_MS = 5000;\nconst TICK_INTERVAL_MS = 1000;\n\nexport default function (pi: ExtensionAPI) {\n\tconst client = new DaemonClient();\n\n\t// Map of running jobs by ID (only running jobs for the current workdir)\n\tconst runningJobs = new Map<string, JobResponse>();\n\n\t// Session CWD\n\tlet sessionCwd: string | undefined;\n\n\t// Cleanup handles\n\tlet unsubscribe: (() => void) | undefined;\n\tlet reconnectTimer: ReturnType<typeof setTimeout> | undefined;\n\tlet tickInterval: ReturnType<typeof setInterval> | undefined;\n\tlet sessionCtx: ExtensionContext | undefined;\n\n\t/**\n\t * Update the widget with current running jobs.\n\t */\n\tfunction updateWidget(): void {\n\t\tif (!sessionCtx?.hasUI) return;\n\n\t\tconst jobs = Array.from(runningJobs.values());\n\n\t\tif (jobs.length === 0) {\n\t\t\tsessionCtx.ui.setWidget(WIDGET_KEY, undefined);\n\t\t\tstopTick();\n\t\t\treturn;\n\t\t}\n\n\t\tsessionCtx.ui.setWidget(\n\t\t\tWIDGET_KEY,\n\t\t\t(_tui, theme) => {\n\t\t\t\treturn {\n\t\t\t\t\trender: (width: number) => renderJobWidget(jobs, theme, width),\n\t\t\t\t\tinvalidate: () => {},\n\t\t\t\t};\n\t\t\t},\n\t\t\t{ placement: \"belowEditor\" },\n\t\t);\n\n\t\tstartTick();\n\t}\n\n\t/**\n\t * Start the 1-second tick interval for updating elapsed times.\n\t */\n\tfunction startTick(): void {\n\t\tif (tickInterval) return;\n\t\ttickInterval = setInterval(() => {\n\t\t\tif (runningJobs.size > 0) {\n\t\t\t\tupdateWidget();\n\t\t\t} else {\n\t\t\t\tstopTick();\n\t\t\t}\n\t\t}, TICK_INTERVAL_MS);\n\t}\n\n\t/**\n\t * Stop the tick interval.\n\t */\n\tfunction stopTick(): void {\n\t\tif (tickInterval) {\n\t\t\tclearInterval(tickInterval);\n\t\t\ttickInterval = undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Handle a daemon event by updating the running jobs map.\n\t */\n\tfunction handleEvent(event: Event): void {\n\t\tconst job = event.job;\n\n\t\tswitch (event.type) {\n\t\t\tcase \"job_added\":\n\t\t\tcase \"job_started\":\n\t\t\tcase \"run_started\":\n\t\t\tcase \"job_updated\":\n\t\t\tcase \"ports_updated\":\n\t\t\t\tif (job.status === \"running\") {\n\t\t\t\t\trunningJobs.set(job.id, job);\n\t\t\t\t} else {\n\t\t\t\t\trunningJobs.delete(job.id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"job_stopped\":\n\t\t\tcase \"run_stopped\":\n\t\t\t\trunningJobs.delete(job.id);\n\t\t\t\tbreak;\n\n\t\t\tcase \"job_removed\":\n\t\t\tcase \"run_removed\":\n\t\t\t\trunningJobs.delete(job.id);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tupdateWidget();\n\t}\n\n\t/**\n\t * Connect to daemon, fetch initial state, and subscribe to events.\n\t */\n\tasync function connectAndSubscribe(): Promise<void> {\n\t\t// Clear any pending reconnect\n\t\tif (reconnectTimer) {\n\t\t\tclearTimeout(reconnectTimer);\n\t\t\treconnectTimer = undefined;\n\t\t}\n\n\t\tconst ok = await client.connect();\n\t\tif (!ok) {\n\t\t\t// Daemon not running, schedule reconnect\n\t\t\tscheduleReconnect();\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Fetch initial list of jobs\n\t\t\tconst jobs = await client.list(sessionCwd);\n\t\t\trunningJobs.clear();\n\t\t\tfor (const job of jobs) {\n\t\t\t\tif (job.status === \"running\") {\n\t\t\t\t\trunningJobs.set(job.id, job);\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdateWidget();\n\t\t} catch {\n\t\t\t// Failed to list, schedule reconnect\n\t\t\tscheduleReconnect();\n\t\t\treturn;\n\t\t}\n\n\t\t// Subscribe to events\n\t\tunsubscribe = client.subscribe(\n\t\t\tsessionCwd,\n\t\t\t(event) => handleEvent(event),\n\t\t\t(_err) => {\n\t\t\t\t// Subscription disconnected, try to reconnect\n\t\t\t\tunsubscribe = undefined;\n\t\t\t\trunningJobs.clear();\n\t\t\t\tupdateWidget();\n\t\t\t\tscheduleReconnect();\n\t\t\t},\n\t\t);\n\t}\n\n\t/**\n\t * Schedule a reconnection attempt.\n\t */\n\tfunction scheduleReconnect(): void {\n\t\tif (reconnectTimer) return;\n\t\treconnectTimer = setTimeout(() => {\n\t\t\treconnectTimer = undefined;\n\t\t\tconnectAndSubscribe();\n\t\t}, RECONNECT_DELAY_MS);\n\t}\n\n\t/**\n\t * Cleanup all connections and timers.\n\t */\n\tfunction cleanup(): void {\n\t\tif (unsubscribe) {\n\t\t\tunsubscribe();\n\t\t\tunsubscribe = undefined;\n\t\t}\n\t\tif (reconnectTimer) {\n\t\t\tclearTimeout(reconnectTimer);\n\t\t\treconnectTimer = undefined;\n\t\t}\n\t\tstopTick();\n\t\tclient.disconnect();\n\t\trunningJobs.clear();\n\t}\n\n\t// ── Lifecycle ──────────────────────────────────────────\n\n\tpi.on(\"session_start\", async (_event, ctx) => {\n\t\tsessionCtx = ctx;\n\t\tsessionCwd = ctx.cwd;\n\t\tawait connectAndSubscribe();\n\t});\n\n\tpi.on(\"session_shutdown\", async () => {\n\t\tcleanup();\n\t\tif (sessionCtx?.hasUI) {\n\t\t\tsessionCtx.ui.setWidget(WIDGET_KEY, undefined);\n\t\t}\n\t\tsessionCtx = undefined;\n\t});\n\n\t// ── Job list UI (existing functionality, now with protocol support) ──\n\n\tasync function fetchJobs(): Promise<JobResponse[]> {\n\t\t// Try daemon protocol first\n\t\tif (client.connected) {\n\t\t\ttry {\n\t\t\t\treturn await client.list(sessionCwd);\n\t\t\t} catch {\n\t\t\t\t// Fall through to CLI\n\t\t\t}\n\t\t}\n\n\t\t// CLI fallback\n\t\tconst result = await pi.exec(\"gob\", [\"list\"]);\n\t\tif (result.code !== 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn parseGobList(result.stdout);\n\t}\n\n\tfunction parseGobList(output: string): JobResponse[] {\n\t\tconst jobs: JobResponse[] = [];\n\t\tconst lines = output.split(\"\\n\").filter((l) => l.trim().length > 0);\n\n\t\tlet i = 0;\n\t\twhile (i < lines.length) {\n\t\t\tconst line = lines[i];\n\t\t\t// Format: <job_id>: [<pid>] <status> (<exit_code>): <command>\n\t\t\tconst match = line.match(/^(\\S+): \\[(\\S+)\\] (\\S+)(?: \\((\\d+)\\))?: (.+)$/);\n\t\t\tif (match) {\n\t\t\t\tconst description =\n\t\t\t\t\ti + 1 < lines.length && lines[i + 1].startsWith(\"         \") ? lines[i + 1].trim() : undefined;\n\n\t\t\t\tif (description) i++;\n\n\t\t\t\tjobs.push({\n\t\t\t\t\tid: match[1],\n\t\t\t\t\tpid: Number.parseInt(match[2], 10) || 0,\n\t\t\t\t\tstatus: match[3],\n\t\t\t\t\tcommand: match[5].split(\" \"),\n\t\t\t\t\tworkdir: \"\",\n\t\t\t\t\tdescription,\n\t\t\t\t\tcreated_at: \"\",\n\t\t\t\t\tstarted_at: \"\",\n\t\t\t\t\tstdout_path: \"\",\n\t\t\t\t\tstderr_path: \"\",\n\t\t\t\t\texit_code: match[4] ? Number.parseInt(match[4], 10) : undefined,\n\t\t\t\t\trun_count: 0,\n\t\t\t\t\tsuccess_count: 0,\n\t\t\t\t\tfailure_count: 0,\n\t\t\t\t\tsuccess_rate: 0,\n\t\t\t\t\tavg_duration_ms: 0,\n\t\t\t\t\tfailure_avg_duration_ms: 0,\n\t\t\t\t\tmin_duration_ms: 0,\n\t\t\t\t\tmax_duration_ms: 0,\n\t\t\t\t});\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\n\t\treturn jobs;\n\t}\n\n\tasync function executeJobAction(action: string, jobId: string): Promise<{ message: string; success: boolean }> {\n\t\t// Try daemon protocol first\n\t\tif (client.connected) {\n\t\t\ttry {\n\t\t\t\tconst resp = await client.sendRequest(action, { job_id: jobId });\n\t\t\t\tif (resp.success) {\n\t\t\t\t\tconst verb =\n\t\t\t\t\t\taction === \"stop\"\n\t\t\t\t\t\t\t? \"Stopped\"\n\t\t\t\t\t\t\t: action === \"start\"\n\t\t\t\t\t\t\t\t? \"Started\"\n\t\t\t\t\t\t\t\t: action === \"restart\"\n\t\t\t\t\t\t\t\t\t? \"Restarted\"\n\t\t\t\t\t\t\t\t\t: action === \"remove\"\n\t\t\t\t\t\t\t\t\t\t? \"Removed\"\n\t\t\t\t\t\t\t\t\t\t: action;\n\t\t\t\t\treturn { message: `${verb} ${jobId}`, success: true };\n\t\t\t\t}\n\t\t\t\treturn { message: `Error: ${resp.error}`, success: false };\n\t\t\t} catch {\n\t\t\t\t// Fall through to CLI\n\t\t\t}\n\t\t}\n\n\t\t// CLI fallback\n\t\tconst result = await pi.exec(\"gob\", [action, jobId]);\n\t\tif (result.code === 0) {\n\t\t\tconst verb =\n\t\t\t\taction === \"stop\"\n\t\t\t\t\t? \"Stopped\"\n\t\t\t\t\t: action === \"start\"\n\t\t\t\t\t\t? \"Started\"\n\t\t\t\t\t\t: action === \"restart\"\n\t\t\t\t\t\t\t? \"Restarted\"\n\t\t\t\t\t\t\t: action === \"remove\"\n\t\t\t\t\t\t\t\t? \"Removed\"\n\t\t\t\t\t\t\t\t: action;\n\t\t\treturn { message: `${verb} ${jobId}`, success: true };\n\t\t}\n\t\treturn { message: `Error: ${result.stderr}`, success: false };\n\t}\n\n\tconst showJobList = async (ctx: ExtensionContext) => {\n\t\tif (!ctx.hasUI) {\n\t\t\tctx.ui.notify(\"No UI available\", \"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst jobs = await fetchJobs();\n\n\t\tif (jobs.length === 0) {\n\t\t\tctx.ui.notify(\"No gob jobs found\", \"info\");\n\t\t\treturn;\n\t\t}\n\n\t\tawait ctx.ui.custom<void>((tui, theme, _kb, done) => {\n\t\t\tconst container = new Container();\n\n\t\t\t// Top border\n\t\t\tcontainer.addChild(new DynamicBorder((s: string) => theme.fg(\"accent\", s)));\n\n\t\t\t// Title\n\t\t\tcontainer.addChild(new Text(theme.fg(\"accent\", theme.bold(\" Gob Jobs\")), 0, 0));\n\n\t\t\t// Build select items\n\t\t\tconst items: SelectItem[] = jobs.map((job) => {\n\t\t\t\tconst statusColor = job.status === \"running\" ? \"success\" : \"muted\";\n\t\t\t\tconst statusIcon = job.status === \"running\" ? \"●\" : \"○\";\n\t\t\t\tconst exitInfo =\n\t\t\t\t\tjob.status === \"stopped\" && job.exit_code != null ? theme.fg(\"dim\", ` (${job.exit_code})`) : \"\";\n\t\t\t\tconst status = theme.fg(statusColor, statusIcon);\n\t\t\t\tconst cmdStr = job.command.join(\" \");\n\t\t\t\tconst label = `${status} ${theme.fg(\"dim\", job.id)} ${cmdStr}${exitInfo}`;\n\t\t\t\tconst description = job.description ? theme.fg(\"muted\", job.description) : undefined;\n\t\t\t\treturn {\n\t\t\t\t\tvalue: job.id,\n\t\t\t\t\tlabel,\n\t\t\t\t\tdescription,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tconst visibleRows = Math.min(jobs.length, 15);\n\t\t\tlet currentIndex = 0;\n\n\t\t\tconst selectList = new SelectList(items, visibleRows, {\n\t\t\t\tselectedPrefix: (t) => theme.fg(\"accent\", t),\n\t\t\t\tselectedText: (t) => t,\n\t\t\t\tdescription: (t) => t,\n\t\t\t\tscrollInfo: (t) => theme.fg(\"dim\", t),\n\t\t\t\tnoMatch: (t) => theme.fg(\"warning\", t),\n\t\t\t});\n\n\t\t\tselectList.onSelect = async (item) => {\n\t\t\t\tdone();\n\t\t\t\tconst job = jobs.find((j) => j.id === item.value);\n\t\t\t\tif (job) {\n\t\t\t\t\tawait showJobActions(ctx, job);\n\t\t\t\t}\n\t\t\t};\n\t\t\tselectList.onCancel = () => done();\n\t\t\tselectList.onSelectionChange = (item) => {\n\t\t\t\tcurrentIndex = items.indexOf(item);\n\t\t\t};\n\t\t\tcontainer.addChild(selectList);\n\n\t\t\t// Help text\n\t\t\tcontainer.addChild(new Text(theme.fg(\"dim\", \" ↑↓ navigate • ←→ page • enter actions • esc close\"), 0, 0));\n\n\t\t\t// Bottom border\n\t\t\tcontainer.addChild(new DynamicBorder((s: string) => theme.fg(\"accent\", s)));\n\n\t\t\treturn {\n\t\t\t\trender: (w) => container.render(w),\n\t\t\t\tinvalidate: () => container.invalidate(),\n\t\t\t\thandleInput: (data) => {\n\t\t\t\t\tif (matchesKey(data, Key.left)) {\n\t\t\t\t\t\tcurrentIndex = Math.max(0, currentIndex - visibleRows);\n\t\t\t\t\t\tselectList.setSelectedIndex(currentIndex);\n\t\t\t\t\t} else if (matchesKey(data, Key.right)) {\n\t\t\t\t\t\tcurrentIndex = Math.min(items.length - 1, currentIndex + visibleRows);\n\t\t\t\t\t\tselectList.setSelectedIndex(currentIndex);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tselectList.handleInput(data);\n\t\t\t\t\t}\n\t\t\t\t\ttui.requestRender();\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t};\n\n\tconst showJobActions = async (ctx: ExtensionContext, job: JobResponse) => {\n\t\tconst actions: string[] = [];\n\n\t\tif (job.status === \"running\") {\n\t\t\tactions.push(\"logs\", \"stop\", \"restart\");\n\t\t} else {\n\t\t\tactions.push(\"logs\", \"start\", \"restart\", \"remove\");\n\t\t}\n\n\t\tconst cmdStr = job.command.join(\" \");\n\t\tconst action = await ctx.ui.select(`${job.id}: ${cmdStr}`, actions);\n\t\tif (!action) return;\n\n\t\tswitch (action) {\n\t\t\tcase \"logs\": {\n\t\t\t\tconst result = await pi.exec(\"gob\", [\"logs\", \"--tail\", \"50\", job.id], { timeout: 5000 });\n\t\t\t\tif (result.code === 0 && result.stdout.trim()) {\n\t\t\t\t\tctx.ui.notify(`Logs for ${job.id}:\\n${result.stdout.trim()}`, \"info\");\n\t\t\t\t} else {\n\t\t\t\t\tctx.ui.notify(`No logs for ${job.id}`, \"info\");\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"stop\":\n\t\t\tcase \"start\":\n\t\t\tcase \"restart\":\n\t\t\tcase \"remove\": {\n\t\t\t\tconst result = await executeJobAction(action, job.id);\n\t\t\t\tctx.ui.notify(result.message, result.success ? \"info\" : \"error\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\t// Register /gob command\n\tpi.registerCommand(\"gob\", {\n\t\tdescription: \"View and manage gob background jobs\",\n\t\thandler: async (_args, ctx) => showJobList(ctx),\n\t});\n}\n"]}