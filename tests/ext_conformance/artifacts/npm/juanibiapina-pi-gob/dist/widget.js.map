{"version":3,"file":"widget.js","sourceRoot":"","sources":["../src/widget.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Widget rendering for gob running jobs.\n * Renders a single horizontal line showing running jobs.\n *\n * Layout: ● server 0:12:34 │ ● build ████░░░ 57% │ ● lint 0:00:05\n */\n\nimport type { Theme } from \"@mariozechner/pi-coding-agent\";\nimport { truncateToWidth } from \"@mariozechner/pi-tui\";\nimport type { JobResponse } from \"./types.js\";\n\n/**\n * Format elapsed time as H:MM:SS or M:SS.\n */\nfunction formatElapsed(startedAt: string): string {\n\tconst start = new Date(startedAt).getTime();\n\tconst now = Date.now();\n\tconst elapsed = Math.max(0, Math.floor((now - start) / 1000));\n\n\tconst hours = Math.floor(elapsed / 3600);\n\tconst minutes = Math.floor((elapsed % 3600) / 60);\n\tconst seconds = elapsed % 60;\n\n\tif (hours > 0) {\n\t\treturn `${hours}:${String(minutes).padStart(2, \"0\")}:${String(seconds).padStart(2, \"0\")}`;\n\t}\n\treturn `${minutes}:${String(seconds).padStart(2, \"0\")}`;\n}\n\n/**\n * Render a progress bar for a job with known average duration.\n * Returns something like \"████░░░░ 57%\" or \"████████ 2:15\" (overtime).\n */\nfunction renderProgress(startedAt: string, avgDurationMs: number, theme: Theme): string {\n\tconst start = new Date(startedAt).getTime();\n\tconst elapsedMs = Date.now() - start;\n\tconst ratio = Math.min(elapsedMs / avgDurationMs, 1);\n\tconst barWidth = 8;\n\tconst filled = Math.round(ratio * barWidth);\n\tconst empty = barWidth - filled;\n\n\tconst isOvertime = elapsedMs > avgDurationMs;\n\n\tif (isOvertime) {\n\t\t// Full bar in warning color + overtime elapsed\n\t\tconst bar = theme.fg(\"warning\", \"█\".repeat(barWidth));\n\t\tconst overtime = formatElapsed(startedAt);\n\t\treturn `${bar} ${theme.fg(\"warning\", overtime)}`;\n\t}\n\n\tconst percent = Math.round(ratio * 100);\n\tconst bar = theme.fg(\"success\", \"█\".repeat(filled)) + theme.fg(\"dim\", \"░\".repeat(empty));\n\treturn `${bar} ${theme.fg(\"dim\", `${percent}%`)}`;\n}\n\n/**\n * Render a single job entry for the widget.\n * Returns: \"● {id} {elapsed_or_progress}\"\n */\nfunction renderJob(job: JobResponse, theme: Theme): string {\n\tconst dot = theme.fg(\"success\", \"●\");\n\tconst cmd = theme.fg(\"text\", job.command.join(\" \"));\n\n\tif (job.avg_duration_ms > 0) {\n\t\tconst info = renderProgress(job.started_at, job.avg_duration_ms, theme);\n\t\treturn `${dot} ${cmd} ${info}`;\n\t}\n\n\treturn `${dot} ${cmd}`;\n}\n\n/**\n * Render the running jobs widget as a single horizontal line.\n * Returns an empty array if no running jobs.\n *\n * @param jobs - Running jobs to display\n * @param theme - Theme for styling\n * @param width - Terminal width for truncation\n */\nexport function renderJobWidget(jobs: JobResponse[], theme: Theme, width: number): string[] {\n\tif (jobs.length === 0) {\n\t\treturn [];\n\t}\n\n\tconst separator = theme.fg(\"dim\", \" │ \");\n\tconst parts = jobs.map((job) => renderJob(job, theme));\n\tconst line = parts.join(separator);\n\n\treturn [truncateToWidth(line, width)];\n}\n"]}