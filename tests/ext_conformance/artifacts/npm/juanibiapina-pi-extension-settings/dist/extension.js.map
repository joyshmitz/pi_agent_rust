{"version":3,"file":"extension.js","sourceRoot":"","sources":["../src/extension.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Pi extension that provides /extension-settings command.\n */\n\nimport type { ExtensionAPI } from \"@mariozechner/pi-coding-agent\";\nimport { getSettingsListTheme } from \"@mariozechner/pi-coding-agent\";\nimport { Container, Text } from \"@mariozechner/pi-tui\";\nimport { type SettingItem, SettingsList } from \"./components/settings-list.js\";\nimport { getSetting, setSetting } from \"./settings/storage.js\";\nimport type { SettingDefinition } from \"./settings/types.js\";\n\ninterface RegistrationPayload {\n\tname: string;\n\tsettings: SettingDefinition[];\n}\n\nexport default function piLibExtension(pi: ExtensionAPI) {\n\t// Local registry - stores settings registered via events\n\tconst registry = new Map<string, SettingDefinition[]>();\n\n\t// Listen for registration events from other extensions\n\tpi.events.on(\"pi-extension-settings:register\", (data) => {\n\t\tconst { name, settings } = data as RegistrationPayload;\n\t\tregistry.set(name, settings);\n\t});\n\n\tpi.registerCommand(\"extension-settings\", {\n\t\tdescription: \"Configure settings for all extensions\",\n\t\thandler: async (_args, ctx) => {\n\t\t\tif (registry.size === 0) {\n\t\t\t\tctx.ui.notify(\"No extensions have registered settings\", \"info\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Sort extensions by name\n\t\t\tconst sortedExtensions = Array.from(registry.entries()).sort(([a], [b]) => a.localeCompare(b));\n\n\t\t\tawait ctx.ui.custom((tui, theme, _kb, done) => {\n\t\t\t\tconst container = new Container();\n\n\t\t\t\t// Title\n\t\t\t\tcontainer.addChild(new Text(theme.fg(\"accent\", theme.bold(\"Extension Settings\")), 1, 1));\n\n\t\t\t\t// Build items grouped by extension\n\t\t\t\tconst items: SettingItem[] = [];\n\n\t\t\t\tfor (const [extName, settings] of sortedExtensions) {\n\t\t\t\t\t// Add extension header as a non-interactive item\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: `__header__${extName}`,\n\t\t\t\t\t\tlabel: theme.bold(extName),\n\t\t\t\t\t\tcurrentValue: \"\",\n\t\t\t\t\t\tvalues: undefined, // No cycling - acts as header\n\t\t\t\t\t});\n\n\t\t\t\t\t// Add each setting\n\t\t\t\t\tfor (const setting of settings) {\n\t\t\t\t\t\tconst currentValue = getSetting(extName, setting.id, setting.defaultValue) ?? setting.defaultValue;\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tid: `${extName}::${setting.id}`,\n\t\t\t\t\t\t\tlabel: `  ${setting.label}`,\n\t\t\t\t\t\t\tdescription: setting.description,\n\t\t\t\t\t\t\tcurrentValue,\n\t\t\t\t\t\t\tvalues: setting.values,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst settingsList = new SettingsList(\n\t\t\t\t\titems,\n\t\t\t\t\tMath.min(items.length + 2, 20),\n\t\t\t\t\tgetSettingsListTheme(),\n\t\t\t\t\t(id, newValue) => {\n\t\t\t\t\t\t// Skip headers\n\t\t\t\t\t\tif (id.startsWith(\"__header__\")) return;\n\n\t\t\t\t\t\t// Parse extension::settingId\n\t\t\t\t\t\tconst [extensionName, settingId] = id.split(\"::\");\n\t\t\t\t\t\tif (extensionName && settingId) {\n\t\t\t\t\t\t\tsetSetting(extensionName, settingId, newValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\tdone(undefined);\n\t\t\t\t\t},\n\t\t\t\t\t{ enableSearch: true },\n\t\t\t\t);\n\n\t\t\t\tcontainer.addChild(settingsList);\n\n\t\t\t\treturn {\n\t\t\t\t\trender(width: number) {\n\t\t\t\t\t\treturn container.render(width);\n\t\t\t\t\t},\n\t\t\t\t\tinvalidate() {\n\t\t\t\t\t\tcontainer.invalidate();\n\t\t\t\t\t},\n\t\t\t\t\thandleInput(data: string) {\n\t\t\t\t\t\tsettingsList.handleInput?.(data);\n\t\t\t\t\t\ttui.requestRender();\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t});\n}\n"]}