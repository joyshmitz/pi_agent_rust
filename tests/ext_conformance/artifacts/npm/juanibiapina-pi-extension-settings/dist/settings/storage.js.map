{"version":3,"file":"storage.js","sourceRoot":"","sources":["../../src/settings/storage.ts"],"names":[],"mappings":"AAAA;;GAEG;AAEH,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,aAAa,EAAE,MAAM,SAAS,CAAC;AAC7E,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,WAAW,CAAC;AAC1C,OAAO,EAAE,WAAW,EAAE,MAAM,+BAA+B,CAAC;AAE5D,MAAM,kBAAkB,GAAG,0BAA0B,CAAC;AAItD;;GAEG;AACH,SAAS,qBAAqB;IAC7B,OAAO,IAAI,CAAC,WAAW,EAAE,EAAE,kBAAkB,CAAC,CAAC;AAChD,CAAC;AAED;;GAEG;AACH,SAAS,gBAAgB,CAAC,IAAY;IACrC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;QACvB,OAAO,EAAE,CAAC;IACX,CAAC;IACD,IAAI,CAAC;QACJ,MAAM,OAAO,GAAG,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAC5C,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAiB,CAAC;IAC5C,CAAC;IAAC,MAAM,CAAC;QACR,OAAO,EAAE,CAAC;IACX,CAAC;AACF,CAAC;AAED;;GAEG;AACH,SAAS,gBAAgB,CAAC,IAAY,EAAE,QAAsB;IAC7D,MAAM,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IAC1B,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC;QACtB,SAAS,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IACrC,CAAC;IACD,aAAa,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;AAC3D,CAAC;AAED;;;;;;;;GAQG;AACH,MAAM,UAAU,UAAU,CAAC,aAAqB,EAAE,SAAiB,EAAE,YAAqB;IACzF,MAAM,UAAU,GAAG,qBAAqB,EAAE,CAAC;IAC3C,MAAM,QAAQ,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;IAE9C,gCAAgC;IAChC,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,CAAC;IAC5C,IAAI,WAAW,IAAI,SAAS,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,WAAW,CAAC,SAAS,CAAC,CAAC;IAC/B,CAAC;IAED,OAAO,YAAY,CAAC;AACrB,CAAC;AAED;;;;;;;GAOG;AACH,MAAM,UAAU,UAAU,CAAC,aAAqB,EAAE,SAAiB,EAAE,KAAa;IACjF,MAAM,UAAU,GAAG,qBAAqB,EAAE,CAAC;IAC3C,MAAM,QAAQ,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;IAE9C,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;QAC9B,QAAQ,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC;IAC9B,CAAC;IACD,QAAQ,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC;IAE3C,gBAAgB,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AACxC,CAAC","sourcesContent":["/**\n * Read/write extension settings to JSON files.\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from \"node:fs\";\nimport { dirname, join } from \"node:path\";\nimport { getAgentDir } from \"@mariozechner/pi-coding-agent\";\n\nconst SETTINGS_FILE_NAME = \"settings-extensions.json\";\n\ntype SettingsFile = Record<string, Record<string, string>>;\n\n/**\n * Get the global settings file path.\n */\nfunction getGlobalSettingsPath(): string {\n\treturn join(getAgentDir(), SETTINGS_FILE_NAME);\n}\n\n/**\n * Load the settings file. Returns empty object if file doesn't exist or is invalid.\n */\nfunction loadSettingsFile(path: string): SettingsFile {\n\tif (!existsSync(path)) {\n\t\treturn {};\n\t}\n\ttry {\n\t\tconst content = readFileSync(path, \"utf-8\");\n\t\treturn JSON.parse(content) as SettingsFile;\n\t} catch {\n\t\treturn {};\n\t}\n}\n\n/**\n * Save settings to the global file.\n */\nfunction saveSettingsFile(path: string, settings: SettingsFile): void {\n\tconst dir = dirname(path);\n\tif (!existsSync(dir)) {\n\t\tmkdirSync(dir, { recursive: true });\n\t}\n\twriteFileSync(path, JSON.stringify(settings, null, \"\\t\"));\n}\n\n/**\n * Get a setting value for an extension.\n * Returns the stored value, or the provided default, or undefined.\n *\n * @param extensionName - Extension name\n * @param settingId - Setting ID within the extension\n * @param defaultValue - Default value if setting is not found\n * @returns The setting value\n */\nexport function getSetting(extensionName: string, settingId: string, defaultValue?: string): string | undefined {\n\tconst globalPath = getGlobalSettingsPath();\n\tconst settings = loadSettingsFile(globalPath);\n\n\t// Check if value exists in file\n\tconst extSettings = settings[extensionName];\n\tif (extSettings && settingId in extSettings) {\n\t\treturn extSettings[settingId];\n\t}\n\n\treturn defaultValue;\n}\n\n/**\n * Set a setting value for an extension.\n * Always writes to the global settings file.\n *\n * @param extensionName - Extension name\n * @param settingId - Setting ID within the extension\n * @param value - Value to set\n */\nexport function setSetting(extensionName: string, settingId: string, value: string): void {\n\tconst globalPath = getGlobalSettingsPath();\n\tconst settings = loadSettingsFile(globalPath);\n\n\tif (!settings[extensionName]) {\n\t\tsettings[extensionName] = {};\n\t}\n\tsettings[extensionName][settingId] = value;\n\n\tsaveSettingsFile(globalPath, settings);\n}\n"]}